TABLE BOOKS TRIGGERS

CREATE DEFINER=`kodilla_user`@`localhost` TRIGGER `BOOKS_INSERT` AFTER INSERT ON `books` FOR EACH ROW BEGIN
	INSERT INTO BOOKS_AUD (EVENT_DATE, EVENT_TYPE, BOOK_ID, NEW_TITLE, NEW_PUBYEAR, NEW_BESTSELLER)
		VALUES (CURTIME(), "INSERT", NEW.BOOK_ID, NEW.TITLE, NEW.PUBYEAR, NEW.BESTSELLER);
END

CREATE DEFINER=`kodilla_user`@`localhost` TRIGGER `BOOKS_DELETE` AFTER DELETE ON `books` FOR EACH ROW BEGIN
	INSERT INTO BOOKS_AUD (EVENT_DATE, EVENT_TYPE, BOOK_ID)
		VALUES (CURTIME(), "DELETE", OLD.BOOK_ID);
END

CREATE DEFINER=`kodilla_user`@`localhost` TRIGGER `BOOKS_UPDATE` AFTER UPDATE ON `books` FOR EACH ROW BEGIN
	INSERT INTO BOOKS_AUD (EVENT_DATE, EVENT_TYPE, BOOK_ID, NEW_TITLE, NEW_PUBYEAR, NEW_BESTSELLER,
							OLD_TITLE, OLD_PUBYEAR, OLD_BESTSELLER)
		VALUES (CURTIME(), "UPDATE", OLD.BOOK_ID, NEW.BOOK_ID, NEW.TITLE, OLD.TITLE, NEW.PUBYEAR,
				OLD.PUBYEAR, NEW.BESTSELLER, OLD.BESTSELLER);
END

---------------------------------------------------------------------------
TABLE READERS TRIGGERS

CREATE DEFINER=`kodilla_user`@`localhost` TRIGGER `READERS_INSERT` AFTER INSERT ON `readers` FOR EACH ROW BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID, NEW_FIRSTNAME, NEW_LASTNAME, 
							NEW_PESELID, NEW_VIP_LEVEL)
		VALUES (CURTIME(), "INSERT", NEW.READER_ID, NEW.FIRSTNAME, NEW.LASTNAME,
				NEW.PESELID, NEW.VIP_LEVEL);
END

CREATE DEFINER=`kodilla_user`@`localhost` TRIGGER `READERS_DELETE` AFTER DELETE ON `readers` FOR EACH ROW BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID)
		VALUES (CURTIME(), "DELETE", OLD.READER_ID);
END

CREATE DEFINER=`kodilla_user`@`localhost` TRIGGER `READERS_UPDATE` AFTER UPDATE ON `readers` FOR EACH ROW BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID, NEW_FIRSTNAME, NEW_LASTNAME, NEW_PESELID,
							NEW_VIP_LEVEL, OLD_FIRSTNAME, OLD_LASTNAME, OLD_PESELID, OLD_VIP_LEVEL)
		VALUES (CURTIME(), "UPDATE", OLD.READER_ID, NEW.FIRSTNAME, OLD.FIRSTNAME, NEW.LASTNAME, OLD.LASTNAME,
				NEW.PESELID, OLD.PESELID, NEW.VIP_LEVEL, OLD.VIP_LEVEL);
END

-------------------------------------------------------------------------
TABLE BOOKS_AUD

CREATE TABLE `books_aud` (
  `EVENT_ID` int NOT NULL AUTO_INCREMENT,
  `EVENT_DATE` datetime NOT NULL,
  `EVENT_TYPE` varchar(10) DEFAULT NULL,
  `BOOK_ID` int NOT NULL,
  `OLD_TITLE` varchar(255) DEFAULT NULL,
  `NEW_TITLE` varchar(255) DEFAULT NULL,
  `OLD_PUBYEAR` int DEFAULT NULL,
  `NEW_PUBYEAR` int DEFAULT NULL,
  `OLD_BESTSELLER` int DEFAULT NULL,
  `NEW_BESTSELLER` int DEFAULT NULL,
  PRIMARY KEY (`EVENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci

--------------------------------------------------------------------------
TABLE READERS_AUD

CREATE TABLE `readers_aud` (
  `EVENT_ID` int NOT NULL AUTO_INCREMENT,
  `EVENT_DATE` datetime NOT NULL,
  `EVENT_TYPE` varchar(10) DEFAULT NULL,
  `READER_ID` int NOT NULL,
  `OLD_FIRSTNAME` varchar(255) DEFAULT NULL,
  `NEW_FIRSTNAME` varchar(255) DEFAULT NULL,
  `OLD_LASTNAME` varchar(255) DEFAULT NULL,
  `NEW_LASTNAME` varchar(255) DEFAULT NULL,
  `OLD_PESELID` int DEFAULT NULL,
  `NEW_PESELID` int DEFAULT NULL,
  `OLD_VIP_LEVEL` varchar(20) DEFAULT NULL,
  `NEW_VIP_LEVEL` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`EVENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci

